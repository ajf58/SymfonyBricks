{% extends "BricksUserBundle::layout.html.twig" %}

{% block main %}

    <div class="row">
        <div class="span12">
            <h1>Brick edit</h1>
            
            <form action="{{ (entity.isNew) ? path('user_brick_create') : path('user_brick_update', { 'id': entity.id }) }}" method="post" {{ form_enctype(form) }} id="user-brick-edit" class="form form-horizontal" novalidate>

                {% if form_errors(form) %}
                    <div class="form-errors">
                        {{ form_errors(form) }}
                    </div>
                {% endif %}
            
                <div class="control-group">
                    <label class="control-label" for="{{ form.title.vars.id }}">{{ form.title.vars.label }}</label>
                    <div class="controls">
                        {{ form_widget(form.title) }}
                    </div>
                </div>
                
                <div class="control-group">
                    <label class="control-label" for="{{ form.description.vars.id }}">{{ form.description.vars.label }}</label>
                    <div class="controls">
                        {{ form_widget(form.description) }}
                    </div>
                </div>
                
                <div class="control-group">
                    <label class="control-label" for="{{ form.content.vars.id }}">{{ form.content.vars.label }}</label>
                    <div class="controls">
                        <ul class="nav nav-tabs" id="content-tab">
                            <li class="active">
                                <a href="#content-code" data-toggle="tab">Code</a>
                            </li>
                            <li>
                                <a href="#content-preview" data-toggle="tab">Preview</a>
                            </li>
                        </ul>
                        <div class="tab-content">
                            <div class="tab-pane active" id="content-code">
                                {{ form_widget(form.content) }}
                            </div>
                            <div class="tab-pane" id="content-preview">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="control-group">
                    <div class="controls">
                        <button type="submit" class="btn btn-success">Save</button>
                        <a href="{{ path('user_brick') }}" class="btn">
                            Back to the list
                        </a>
                    </div>
                </div>
                
                {{ form_rest(form) }}
                
            </form>
            
        </div>
    </div>

{% endblock %}

{% block javascripts_footer %}
    <script type="text/javascript">
        jQuery(function($) {
            $('a[data-toggle="tab"]').on('shown', function (e) {
                
                // tab element pressed
                var tabCaller = $(e.target);

                // tab pane related
                var paneTarget = $(tabCaller.attr('href'));

                // if preview is requested
                if (tabCaller.attr('href') == '#content-preview') {

                    /**
                     * perform ajax call to preview content
                     */
                	$.ajax({
                	    url: "{{ path('_user_brick_renderMarkdown') }}",
                	    data: {
            	            'content': $('#content-code textarea').val()
        	            },
        	            type: 'POST',
        	            beforeSend: function(e) {
        	            	$('#content-preview').html('loading preview...');
                        },
        	            complete: function(e) {
        	            	$('#content-preview').html(e.responseText);
                        }
            		})
                }
            })
        });
    </script>
{% endblock %}
